---
phase: 11-ui-polish
plan: "02"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(dashboard)/automations/loading.tsx
  - src/app/(dashboard)/automations/[id]/loading.tsx
autonomous: true

must_haves:
  truths:
    - "Navigating to /automations shows skeleton placeholders while the automation list loads"
    - "Navigating to an automation detail page shows skeleton placeholders while data fetches"
    - "The automations list page already has a proper empty state — it is preserved and not regressed"
    - "The automation detail page card layout is consistent (configuration card + AI copy generator card)"
  artifacts:
    - path: "src/app/(dashboard)/automations/loading.tsx"
      provides: "Automation list skeleton (table header + rows)"
    - path: "src/app/(dashboard)/automations/[id]/loading.tsx"
      provides: "Automation detail skeleton (back link + heading + config card + AI card)"
  key_links:
    - from: "src/app/(dashboard)/automations/loading.tsx"
      to: "src/components/ui/skeleton.tsx"
      via: "import { Skeleton }"
      pattern: "import.*Skeleton.*from.*ui/skeleton"
    - from: "src/app/(dashboard)/automations/[id]/loading.tsx"
      to: "src/components/ui/skeleton.tsx"
      via: "import { Skeleton }"
      pattern: "import.*Skeleton.*from.*ui/skeleton"
---

<objective>
Add skeleton loaders for the automation list and automation detail pages by creating loading.tsx files in each route directory.

Purpose: Eliminate blank-screen flashes on automation page navigations during a demo. The automation pages fetch data server-side (listAutomations, db.select automations) so loading.tsx Suspense boundaries cover the fetch latency.
Output: Two loading.tsx files that mirror the visual structure of the automation list and detail pages.
</objective>

<execution_context>
@/Users/zhangjiabei/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zhangjiabei/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@src/app/(dashboard)/automations/page.tsx
@src/app/(dashboard)/automations/[id]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create automation list loading.tsx</name>
  <files>
    src/app/(dashboard)/automations/loading.tsx
  </files>
  <action>
    Create src/app/(dashboard)/automations/loading.tsx.

    The automation list page renders either a table (when automations exist) or an empty state card. The skeleton should represent the table state (more visually informative as a loader):

    ```tsx
    import { Skeleton } from '@/components/ui/skeleton'

    export default function AutomationsLoading() {
      return (
        <div className="flex flex-col gap-6">
          {/* Page header skeleton */}
          <div className="flex items-center justify-between">
            <div className="flex flex-col gap-2">
              <Skeleton className="h-8 w-40" />
              <Skeleton className="h-4 w-72" />
            </div>
          </div>

          {/* Table skeleton */}
          <div className="rounded-lg border bg-card overflow-hidden">
            {/* Table header row */}
            <div className="border-b bg-muted/50 grid grid-cols-7 gap-4 px-4 py-3">
              {['Flow Name', 'Trigger', 'Delay', 'Action', 'Status', 'Last Run', 'Toggle'].map((col) => (
                <Skeleton key={col} className="h-3 w-full max-w-[72px]" />
              ))}
            </div>

            {/* Table data rows — 5 rows for 5 preset automations */}
            {Array.from({ length: 5 }).map((_, i) => (
              <div
                key={i}
                className="grid grid-cols-7 gap-4 px-4 py-3 border-b last:border-0 items-center"
              >
                <Skeleton className="h-4 w-32" />
                <Skeleton className="h-4 w-36" />
                <Skeleton className="h-4 w-16" />
                <Skeleton className="h-4 w-20" />
                <Skeleton className="h-5 w-16 rounded-full" />
                <Skeleton className="h-4 w-24" />
                <Skeleton className="h-6 w-10 rounded-md" />
              </div>
            ))}
          </div>
        </div>
      )
    }
    ```

    Note: The `grid-cols-7` matches the 7 columns in the automation list table (Flow Name, Trigger, Delay, Action, Status, Last Run, Toggle). The column widths are approximate but visually match the table proportions.
  </action>
  <verify>
    Run `npx tsc --noEmit` — no type errors.
    Confirm src/app/(dashboard)/automations/loading.tsx exists and imports Skeleton from '@/components/ui/skeleton'.
  </verify>
  <done>
    File exists, TypeScript compiles, skeleton mirrors 7-column automation table layout.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create automation detail loading.tsx</name>
  <files>
    src/app/(dashboard)/automations/[id]/loading.tsx
  </files>
  <action>
    Create src/app/(dashboard)/automations/[id]/loading.tsx.

    The automation detail page structure is:
    - Back link ("← Back to Automations")
    - Heading + status badge
    - Configuration card (read-only metadata dl grid + editable form + email preview)
    - AI Email Copy Generator card

    Mirror this structure in the skeleton:

    ```tsx
    import { Skeleton } from '@/components/ui/skeleton'

    export default function AutomationDetailLoading() {
      return (
        <div className="flex flex-col gap-6">
          {/* Back link skeleton */}
          <Skeleton className="h-4 w-36" />

          {/* Heading + badge skeleton */}
          <div className="flex items-center gap-3">
            <Skeleton className="h-8 w-56" />
            <Skeleton className="h-5 w-16 rounded-full" />
          </div>

          {/* Configuration card skeleton */}
          <div className="rounded-lg border bg-card p-6">
            <Skeleton className="h-6 w-32 mb-4" />

            {/* Read-only metadata grid (2 cols, 4 items) */}
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
              {Array.from({ length: 4 }).map((_, i) => (
                <div key={i} className="flex flex-col gap-2">
                  <Skeleton className="h-3 w-20" />
                  <Skeleton className="h-4 w-32" />
                </div>
              ))}
            </div>

            {/* Editable form area + preview skeleton */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {/* Form fields */}
              <div className="flex flex-col gap-4">
                {Array.from({ length: 4 }).map((_, i) => (
                  <div key={i} className="flex flex-col gap-1.5">
                    <Skeleton className="h-3 w-24" />
                    <Skeleton className="h-9 w-full" />
                  </div>
                ))}
                {/* Button row */}
                <div className="flex gap-2 pt-2">
                  <Skeleton className="h-9 w-16" />
                  <Skeleton className="h-9 w-16" />
                  <Skeleton className="h-9 w-28 ml-auto" />
                </div>
              </div>

              {/* Email preview */}
              <div className="flex flex-col gap-2">
                <Skeleton className="h-3 w-24 mb-1" />
                <Skeleton className="h-64 w-full rounded-md" />
              </div>
            </div>
          </div>

          {/* AI Email Copy Generator card skeleton */}
          <div className="rounded-lg border bg-card p-6">
            <Skeleton className="h-6 w-44 mb-2" />
            <Skeleton className="h-4 w-80 mb-4" />
            <div className="flex flex-col gap-3">
              <Skeleton className="h-9 w-40" />
            </div>
          </div>
        </div>
      )
    }
    ```

    Note: The form + preview grid uses `lg:grid-cols-2` to match AutomationDetailClient's layout (form on left, email preview on right). The 4 form fields cover delay value, delay unit, subject, and body. The 3 buttons cover Save, Cancel, and Send Test Email.
  </action>
  <verify>
    Run `npx tsc --noEmit` — no type errors.
    Confirm src/app/(dashboard)/automations/[id]/loading.tsx exists and imports Skeleton from '@/components/ui/skeleton'.
  </verify>
  <done>
    File exists, TypeScript compiles, skeleton mirrors the two-card automation detail page layout including the form+preview grid.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. src/app/(dashboard)/automations/loading.tsx exists — 7-column table skeleton
3. src/app/(dashboard)/automations/[id]/loading.tsx exists — back link + heading + config card + AI card skeleton
4. Both files import Skeleton from '@/components/ui/skeleton' (installed in plan 11-01)
5. The existing empty state in automations/page.tsx is untouched (preserved)
</verification>

<success_criteria>
- Navigating to /automations shows a table skeleton while data fetches
- Navigating to /automations/[id] shows a structured skeleton matching the detail page layout
- TypeScript strict compilation passes
- The existing automations page empty state ("No automation flows configured" + SeedAutomationsButton) is not regressed
</success_criteria>

<output>
After completion, create `.planning/phases/11-ui-polish/11-02-SUMMARY.md` using the summary template.
</output>
