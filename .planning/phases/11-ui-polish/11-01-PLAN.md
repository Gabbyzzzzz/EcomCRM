---
phase: 11-ui-polish
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/(dashboard)/loading.tsx
  - src/app/(dashboard)/customers/loading.tsx
  - src/app/(dashboard)/page.tsx
  - src/components/customer-filters.tsx
  - src/components/ui/skeleton.tsx
autonomous: true

must_haves:
  truths:
    - "Navigating to the dashboard shows skeleton placeholders while data loads (no blank white flash)"
    - "When no customers exist, the dashboard shows a meaningful empty state instead of all zeros"
    - "Navigating to /customers shows a skeleton table while data loads"
    - "When the customer list has no results, the empty state includes actionable guidance"
  artifacts:
    - path: "src/app/(dashboard)/loading.tsx"
      provides: "Dashboard skeleton loader (KPI cards + chart placeholders)"
    - path: "src/app/(dashboard)/customers/loading.tsx"
      provides: "Customer list skeleton (header + table rows)"
    - path: "src/components/ui/skeleton.tsx"
      provides: "shadcn/ui Skeleton component"
  key_links:
    - from: "src/app/(dashboard)/loading.tsx"
      to: "src/components/ui/skeleton.tsx"
      via: "import { Skeleton }"
      pattern: "import.*Skeleton.*from.*ui/skeleton"
    - from: "src/app/(dashboard)/customers/loading.tsx"
      to: "src/components/ui/skeleton.tsx"
      via: "import { Skeleton }"
      pattern: "import.*Skeleton.*from.*ui/skeleton"
---

<objective>
Add skeleton loaders for the dashboard and customer list pages, improve the dashboard empty state for zero-customer stores, and enhance the customer list empty state with actionable guidance.

Purpose: Demo-readiness — the app must not flash blank screens or show raw zeros when there's no data.
Output: Two loading.tsx files (dashboard + customers), an improved dashboard empty state, improved customer empty state guidance, and the shadcn/ui Skeleton component.
</objective>

<execution_context>
@/Users/zhangjiabei/.claude/get-shit-done/workflows/execute-plan.md
@/Users/zhangjiabei/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/app/(dashboard)/page.tsx
@src/app/(dashboard)/customers/page.tsx
@src/components/customer-filters.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Skeleton component and create loading.tsx files</name>
  <files>
    src/components/ui/skeleton.tsx
    src/app/(dashboard)/loading.tsx
    src/app/(dashboard)/customers/loading.tsx
  </files>
  <action>
    1. Add the shadcn/ui Skeleton component. Run: `npx shadcn@latest add skeleton --yes` from the project root. This creates src/components/ui/skeleton.tsx with the standard implementation (a div with `animate-pulse rounded-md bg-muted`).

    2. Create src/app/(dashboard)/loading.tsx — the dashboard skeleton. This file is auto-used by Next.js App Router as a Suspense fallback while page.tsx fetches data. Structure it to mirror the dashboard layout:

    ```tsx
    import { Skeleton } from '@/components/ui/skeleton'

    export default function DashboardLoading() {
      return (
        <div className="flex flex-col gap-6">
          {/* Heading skeleton */}
          <div className="flex flex-col gap-2">
            <Skeleton className="h-8 w-48" />
            <Skeleton className="h-4 w-64" />
          </div>

          {/* KPI cards skeleton — 4 cards in a responsive grid */}
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            {Array.from({ length: 4 }).map((_, i) => (
              <div key={i} className="rounded-lg border bg-card p-6 flex flex-col gap-3">
                <Skeleton className="h-3 w-28" />
                <Skeleton className="h-8 w-24" />
              </div>
            ))}
          </div>

          {/* Charts skeleton — 2 side by side */}
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
            {Array.from({ length: 2 }).map((_, i) => (
              <div key={i} className="rounded-lg border bg-card p-6">
                <Skeleton className="h-4 w-36 mb-4" />
                <Skeleton className="h-48 w-full" />
              </div>
            ))}
          </div>

          {/* Churn alerts skeleton */}
          <div className="rounded-lg border bg-card p-6">
            <Skeleton className="h-4 w-28 mb-4" />
            <div className="flex flex-col gap-2">
              {Array.from({ length: 3 }).map((_, i) => (
                <Skeleton key={i} className="h-4 w-full max-w-xs" />
              ))}
            </div>
          </div>

          {/* Recent activity skeleton */}
          <div className="rounded-lg border bg-card p-6">
            <Skeleton className="h-4 w-32 mb-4" />
            <div className="flex flex-col gap-3">
              {Array.from({ length: 5 }).map((_, i) => (
                <Skeleton key={i} className="h-4 w-full" />
              ))}
            </div>
          </div>
        </div>
      )
    }
    ```

    3. Create src/app/(dashboard)/customers/loading.tsx — the customers skeleton. Mirror the customers page layout (header + table):

    ```tsx
    import { Skeleton } from '@/components/ui/skeleton'

    export default function CustomersLoading() {
      return (
        <div className="flex flex-col gap-6">
          {/* Page header skeleton */}
          <div className="flex flex-col gap-2">
            <Skeleton className="h-8 w-36" />
            <Skeleton className="h-4 w-56" />
          </div>

          {/* Filter bar skeleton */}
          <div className="flex gap-3">
            <Skeleton className="h-9 flex-1 min-w-[240px]" />
            <Skeleton className="h-9 w-36" />
          </div>

          {/* Table skeleton */}
          <div className="rounded-lg border bg-card overflow-hidden">
            {/* Header row */}
            <div className="border-b bg-muted/50 px-4 py-3 grid grid-cols-6 gap-4">
              {Array.from({ length: 6 }).map((_, i) => (
                <Skeleton key={i} className="h-3 w-full max-w-[80px]" />
              ))}
            </div>
            {/* Data rows */}
            {Array.from({ length: 8 }).map((_, i) => (
              <div key={i} className="border-b last:border-0 px-4 py-3 grid grid-cols-6 gap-4 items-center">
                <Skeleton className="h-4 w-28" />
                <Skeleton className="h-4 w-36" />
                <Skeleton className="h-5 w-20 rounded-full" />
                <Skeleton className="h-4 w-16 ml-auto" />
                <Skeleton className="h-4 w-8 ml-auto" />
                <Skeleton className="h-4 w-20" />
              </div>
            ))}
          </div>
        </div>
      )
    }
    ```
  </action>
  <verify>
    Run `npx tsc --noEmit` from project root — no type errors on the new loading.tsx files.
    Confirm src/components/ui/skeleton.tsx exists.
    Confirm src/app/(dashboard)/loading.tsx exists.
    Confirm src/app/(dashboard)/customers/loading.tsx exists.
  </verify>
  <done>
    Three files exist and TypeScript compilation passes. Loading skeletons mirror the visual structure of their respective pages.
  </done>
</task>

<task type="auto">
  <name>Task 2: Dashboard zero-state and customer list empty-state improvements</name>
  <files>
    src/app/(dashboard)/page.tsx
    src/components/customer-filters.tsx
  </files>
  <action>
    1. In src/app/(dashboard)/page.tsx, add a top-level empty state for zero-customer stores. After the heading section and before the KPI cards grid, check `kpis.totalCustomers === 0`. If true, render an empty state card instead of the KPI grid, charts, churn alerts, and activity feed:

    ```tsx
    {kpis.totalCustomers === 0 ? (
      <div className="rounded-lg border bg-card p-12 text-center">
        <h2 className="text-lg font-medium mb-2">No customers yet</h2>
        <p className="text-sm text-muted-foreground mb-6 max-w-sm mx-auto">
          Sync your Shopify store to import customers and start seeing CRM metrics here.
        </p>
        <a
          href="/settings/sync"
          className="inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 transition-colors"
        >
          Go to Sync Settings
        </a>
      </div>
    ) : (
      /* existing KPI cards, charts, churn alerts, activity — wrap the existing JSX */
      <>
        {/* KPI Cards */}
        ...
        {/* Charts */}
        ...
        {/* Churn Alerts */}
        ...
        {/* Recent Activity */}
        ...
      </>
    )}
    ```

    Wrap all content after the heading (lines 96–241 in the current page.tsx) in the `else` branch of this conditional. The heading div (lines 87–93) stays outside the conditional — it always renders.

    2. In src/components/customer-filters.tsx, improve the empty state inside the table (lines 176–183). The current empty state says "No customers found." — improve it to distinguish between:
    - No filters active + zero results: "No customers found. Sync your Shopify store to import customers." with a link to /settings/sync
    - Filters active + zero results: "No customers match your filters." with a "Clear filters" instruction

    Update the empty state block:
    ```tsx
    {rows.length === 0 ? (
      <div className="p-12 text-center">
        {search || segment ? (
          <>
            <p className="text-sm font-medium mb-1">No customers match your filters.</p>
            <p className="text-xs text-muted-foreground">
              Try clearing the search or segment filter.
            </p>
          </>
        ) : (
          <>
            <p className="text-sm font-medium mb-1">No customers found.</p>
            <p className="text-xs text-muted-foreground mb-3">
              Import your Shopify customers to get started.
            </p>
            <a
              href="/settings/sync"
              className="text-xs text-primary hover:underline"
            >
              Go to Sync Settings &rarr;
            </a>
          </>
        )}
      </div>
    ) : (
    ```
  </action>
  <verify>
    Run `npx tsc --noEmit` — no type errors.
    Review dashboard page.tsx: when `kpis.totalCustomers === 0`, the KPI grid and charts are replaced by the empty state card. When customers exist, the full dashboard renders normally.
    Review customer-filters.tsx: empty state block shows filter-specific message vs. sync-guidance message based on active filters.
  </verify>
  <done>
    Dashboard with zero customers shows "No customers yet" card with a link to sync settings instead of a grid of zeros. Customer list empty state distinguishes between "no data" (sync guidance) and "no filter match" (clear filter guidance). TypeScript compiles clean.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. src/components/ui/skeleton.tsx exists (installed via shadcn)
3. src/app/(dashboard)/loading.tsx exists and imports Skeleton
4. src/app/(dashboard)/customers/loading.tsx exists and imports Skeleton
5. Dashboard page.tsx has a conditional block: `kpis.totalCustomers === 0` → empty state card, else → full dashboard content
6. customer-filters.tsx empty state distinguishes filtered vs. unfiltered cases
</verification>

<success_criteria>
- Skeleton loaders appear on dashboard and customer list navigations (verified by Next.js loading.tsx mechanism)
- Dashboard empty state shows "No customers yet" + sync link when totalCustomers === 0
- Customer list empty state shows sync guidance when unfiltered and no results, filter guidance when filters are active
- TypeScript strict compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/11-ui-polish/11-01-SUMMARY.md` using the summary template.
</output>
